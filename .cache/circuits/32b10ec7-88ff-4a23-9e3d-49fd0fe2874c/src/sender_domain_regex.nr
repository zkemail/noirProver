use zkregex::utils::{
   select_subarray,
   captures::capture_substring,
   sparse_array::SparseArray,
   transitions::check_transition_with_captures
};

global TRANSITION_TABLE: SparseArray<700, Field> = SparseArray {
    keys: [0x00000000, 0x0002110f, 0x00021110, 0x0003100f, 0x00046e6a, 0x00046e6d, 0x00057c7b, 0x00067b7a, 0x00077b7a, 0x00081010, 0x00081111, 0x00081212, 0x00081313, 0x00081414, 0x00081515, 0x00081616, 0x00081717, 0x00081818, 0x00081919, 0x00081b1b, 0x00081c1c, 0x00081e1e, 0x00081f1f, 0x00082020, 0x00082121, 0x00082222, 0x00082323, 0x00082424, 0x00082525, 0x00082626, 0x00082727, 0x00082828, 0x00082929, 0x00082a2a, 0x00082b2b, 0x00082c2c, 0x00082d2d, 0x00082e2e, 0x00082f2f, 0x00083030, 0x00083131, 0x00083232, 0x00083333, 0x00083434, 0x00083535, 0x00083636, 0x00083737, 0x00083838, 0x00083939, 0x00083a3a, 0x00083b3b, 0x00083c3c, 0x00083d3d, 0x00083e3e, 0x00083f3f, 0x00084040, 0x00084141, 0x00084242, 0x00084343, 0x00084444, 0x00084545, 0x00084646, 0x00084747, 0x00084848, 0x00084949, 0x00084a49, 0x00084a4a, 0x00084b4b, 0x00084c4c, 0x00084d4d, 0x00084e4e, 0x00084f4f, 0x00085050, 0x00085151, 0x00085252, 0x00085353, 0x00085454, 0x00085555, 0x00085656, 0x00085757, 0x00085858, 0x00085959, 0x00085a5a, 0x00085b5b, 0x00085c5c, 0x00085d5d, 0x00085e5e, 0x00085f5f, 0x00086060, 0x00086161, 0x00086262, 0x00086363, 0x00086464, 0x00086565, 0x00086666, 0x00086767, 0x00086868, 0x00086969, 0x00086a6a, 0x00086b6b, 0x00086c6c, 0x00086d6d, 0x00086e6e, 0x00086f6f, 0x00087070, 0x00087171, 0x00087272, 0x00087373, 0x00087474, 0x00087575, 0x00087676, 0x00087777, 0x00087878, 0x00087979, 0x00087a7a, 0x00087b7b, 0x00087c7c, 0x00087d7d, 0x00087e7e, 0x00087f7f, 0x00088080, 0x00088181, 0x00088282, 0x00088383, 0x00088484, 0x00088585, 0x00088686, 0x00088787, 0x00088888, 0x00088989, 0x00088a8a, 0x00088b8b, 0x00088c8c, 0x00088d8d, 0x00088e8e, 0x00088f8f, 0x00089091, 0x00089192, 0x00089293, 0x00089394, 0x00089495, 0x00089596, 0x00089697, 0x00089798, 0x00089899, 0x0008999a, 0x00089a9b, 0x00089b9c, 0x00089c9d, 0x00089d9e, 0x00089e9f, 0x00089fa0, 0x0008a0a1, 0x0008a1a2, 0x0008a2a3, 0x0008a3a4, 0x0008a4a5, 0x0008a5a6, 0x0008a6a7, 0x0008a7a8, 0x0008a8a9, 0x0008a9aa, 0x0008aaab, 0x0008abac, 0x0008acad, 0x0008adae, 0x0008aeaf, 0x0008afb0, 0x0008b0b1, 0x0008b1b2, 0x0008b2b3, 0x0008b3b4, 0x0008b4b5, 0x0008b5b6, 0x0008b6b7, 0x0008b7b8, 0x0008b8b9, 0x0008b9ba, 0x0008babb, 0x0008bbbc, 0x0008bcbd, 0x0008bdbe, 0x0008bebf, 0x0008bfc0, 0x0008c0c1, 0x0008c1c2, 0x0008c2c3, 0x0008c3c4, 0x0008c4c5, 0x0008c5c6, 0x0008c6c7, 0x0008c7c8, 0x0008c8c9, 0x0008c9ca, 0x0008cacb, 0x0008cbcc, 0x0008cccd, 0x0008cdce, 0x0008cecf, 0x0008cfd0, 0x00099294, 0x00099295, 0x00099395, 0x00099396, 0x00099496, 0x00099497, 0x00099597, 0x00099598, 0x00099698, 0x00099699, 0x00099799, 0x0009979a, 0x0009989a, 0x0009989b, 0x0009999b, 0x0009999c, 0x00099a9c, 0x00099a9d, 0x00099b9d, 0x00099b9e, 0x00099c9e, 0x00099c9f, 0x00099d9f, 0x00099da0, 0x00099ea0, 0x00099ea1, 0x00099fa1, 0x00099fa2, 0x0009a0a2, 0x0009a0a3, 0x0009a1a3, 0x0009a1a4, 0x0009a2a4, 0x0009a2a5, 0x0009a3a5, 0x0009a3a6, 0x0009a4a6, 0x0009a4a7, 0x0009a5a7, 0x0009a5a8, 0x0009a6a8, 0x0009a6a9, 0x0009a7a9, 0x0009a7aa, 0x0009a8aa, 0x0009a8ab, 0x0009a9ab, 0x0009a9ac, 0x0009aaac, 0x0009aaad, 0x0009abad, 0x0009abae, 0x0009acae, 0x0009acaf, 0x0009adaf, 0x0009adb0, 0x0009aeb0, 0x0009aeb1, 0x0009afb1, 0x0009afb2, 0x0009b0b2, 0x0009b0b3, 0x0009b1b3, 0x0009b1b4, 0x0009b2b3, 0x0009b2b4, 0x0009b3b4, 0x0009b3b5, 0x0009b4b5, 0x0009b4b6, 0x0009b5b6, 0x0009b5b7, 0x0009b6b7, 0x0009b6b8, 0x0009b7b8, 0x0009b7b9, 0x0009b8b9, 0x0009b8ba, 0x0009b9ba, 0x0009b9bb, 0x0009babb, 0x0009babc, 0x0009bbbc, 0x0009bbbd, 0x0009bcbd, 0x0009bcbe, 0x0009bdbe, 0x0009bdbf, 0x0009bebf, 0x0009bec0, 0x0009bfc0, 0x0009bfc1, 0x0009c0c1, 0x0009c0c2, 0x0009c1c2, 0x0009c1c3, 0x0009c2c3, 0x0009c2c4, 0x0009c3c4, 0x0009c3c5, 0x0009c4c5, 0x0009c4c6, 0x0009c5c6, 0x0009c5c7, 0x0009c6c7, 0x0009c6c8, 0x0009c7c8, 0x0009c7c9, 0x0009c8c9, 0x0009c8ca, 0x0009c9ca, 0x0009c9cb, 0x0009cacb, 0x0009cacc, 0x0009cbcc, 0x0009cbcd, 0x0009cccd, 0x0009ccce, 0x0009cdce, 0x0009cdcf, 0x0009cecf, 0x0009ced0, 0x0009cfd0, 0x0009cfd1, 0x0009d0d1, 0x0009d0d2, 0x0009d1d2, 0x0009d1d3, 0x0009d4d3, 0x0009d5d4, 0x0009d6d5, 0x0009d7d6, 0x0009d8d7, 0x0009d9d8, 0x0009dad9, 0x0009dbda, 0x0009dcdb, 0x0009dddc, 0x0009dedd, 0x0009dfde, 0x0009e0df, 0x0009e1e0, 0x0009e2e1, 0x0009e3e2, 0x0009e4e3, 0x0009e5e4, 0x0009e6e5, 0x0009e7e6, 0x0009e8e7, 0x0009e9e8, 0x0009eae9, 0x0009ebea, 0x0009eceb, 0x0009edec, 0x0009eeed, 0x0009efee, 0x0009f0ef, 0x0009f1f0, 0x000af4f2, 0x000b9699, 0x000b969a, 0x000b979a, 0x000b979b, 0x000b989b, 0x000b989c, 0x000b999c, 0x000b999d, 0x000b9a9d, 0x000b9a9e, 0x000b9b9e, 0x000b9b9f, 0x000b9c9f, 0x000b9ca0, 0x000b9da0, 0x000b9da1, 0x000b9ea1, 0x000b9ea2, 0x000b9fa2, 0x000b9fa3, 0x000ba0a3, 0x000ba0a4, 0x000ba1a4, 0x000ba1a5, 0x000ba2a5, 0x000ba2a6, 0x000ba3a6, 0x000ba3a7, 0x000ba4a7, 0x000ba4a8, 0x000ba5a8, 0x000ba5a9, 0x000ba6a8, 0x000ba6a9, 0x000ba7a9, 0x000ba7aa, 0x000ba8aa, 0x000ba8ab, 0x000ba9ab, 0x000ba9ac, 0x000baaac, 0x000baaad, 0x000babad, 0x000babae, 0x000bacae, 0x000bacaf, 0x000badaf, 0x000badb0, 0x000baeb0, 0x000baeb1, 0x000bafb1, 0x000bafb2, 0x000bb0b2, 0x000bb0b3, 0x000bb1b3, 0x000bb1b4, 0x000bb2b4, 0x000bb2b5, 0x000bb3b5, 0x000bb3b6, 0x000bb4b6, 0x000bb4b7, 0x000bb5b7, 0x000bb5b8, 0x000bb6b8, 0x000bb6b9, 0x000bb7b9, 0x000bb7ba, 0x000bb8ba, 0x000bb8bb, 0x000bb9bb, 0x000bb9bc, 0x000bbabc, 0x000bbabd, 0x000bbbbd, 0x000bbbbe, 0x000bbcbe, 0x000bbcbf, 0x000bbdbf, 0x000bbdc0, 0x000bbec0, 0x000bbec1, 0x000bbfc1, 0x000bbfc2, 0x000bc0c2, 0x000bc0c3, 0x000bc1c3, 0x000bc1c4, 0x000bc2c4, 0x000bc2c5, 0x000bc3c5, 0x000bc3c6, 0x000bc4c6, 0x000bc4c7, 0x000bc5c7, 0x000bc5c8, 0x000bc6c8, 0x000bc6c9, 0x000bc7c9, 0x000bc7ca, 0x000bc8ca, 0x000bc8cb, 0x000bc9cb, 0x000bc9cc, 0x000bcacc, 0x000bcacd, 0x000bcbcd, 0x000bcbce, 0x000bccce, 0x000bcccf, 0x000bcdcf, 0x000bcdd0, 0x000bced0, 0x000bced1, 0x000bcfd1, 0x000bcfd2, 0x000bd0d2, 0x000bd0d3, 0x000bd1d3, 0x000bd1d4, 0x000bd2d4, 0x000bd2d5, 0x000bd3d5, 0x000bd3d6, 0x000bd4d6, 0x000bd4d7, 0x000bd5d7, 0x000bd5d8, 0x000bf7f4, 0x000bf8f5, 0x000bf9f6, 0x000bfaf7, 0x000bfbf8, 0x000bfcf9, 0x000bfdfa, 0x000bfefb, 0x000bfffc, 0x000c00fd, 0x000c01fe, 0x000c02ff, 0x000c0501, 0x000c0602, 0x000d0601, 0x000e0b05, 0x000f0e07, 0x000f0f08, 0x000f1009, 0x0010130b, 0x00106058, 0x00115251, 0x00115352, 0x00115453, 0x00115554, 0x00115655, 0x00115756, 0x00115857, 0x00115958, 0x00115a59, 0x00115b5a, 0x00116362, 0x00116463, 0x00116564, 0x00116665, 0x00116766, 0x00116867, 0x00116968, 0x00116a69, 0x00116b6a, 0x00116c6b, 0x00116d6c, 0x00116e6d, 0x00116f6e, 0x0011706f, 0x00117170, 0x00117271, 0x00117372, 0x00117473, 0x00117574, 0x00117675, 0x00117776, 0x00117877, 0x00117978, 0x00117a79, 0x00117b7a, 0x00117c7b, 0x00118382, 0x00118483, 0x00118584, 0x00118685, 0x00118786, 0x00118887, 0x00118988, 0x00118a89, 0x00118b8a, 0x00118c8b, 0x00118d8c, 0x00118e8d, 0x00118f8e, 0x0011908f, 0x00119190, 0x00119291, 0x00119392, 0x00119493, 0x00119594, 0x00119695, 0x00119796, 0x00119897, 0x00119998, 0x00119a99, 0x00119b9a, 0x00119c9b, 0x00125150, 0x00125151, 0x00125251, 0x00125252, 0x00125453, 0x00125454, 0x00125554, 0x00125555, 0x00125655, 0x00125656, 0x00125756, 0x00125757, 0x00125857, 0x00125858, 0x00125958, 0x00125959, 0x00125a59, 0x00125a5a, 0x00125b5a, 0x00125b5b, 0x00125c5b, 0x00125c5c, 0x00125d5c, 0x00125d5d, 0x00126564, 0x00126565, 0x00126665, 0x00126666, 0x00126766, 0x00126767, 0x00126867, 0x00126868, 0x00126968, 0x00126969, 0x00126a69, 0x00126a6a, 0x00126b6a, 0x00126b6b, 0x00126c6b, 0x00126c6c, 0x00126d6c, 0x00126d6d, 0x00126e6d, 0x00126e6e, 0x00126f6e, 0x00126f6f, 0x0012706f, 0x00127070, 0x00127170, 0x00127171, 0x00127271, 0x00127272, 0x00127372, 0x00127373, 0x00127473, 0x00127474, 0x00127574, 0x00127575, 0x00127675, 0x00127676, 0x00127776, 0x00127777, 0x00127877, 0x00127878, 0x00127978, 0x00127979, 0x00127a79, 0x00127a7a, 0x00127b7a, 0x00127b7b, 0x00127c7b, 0x00127c7c, 0x00127d7c, 0x00127d7d, 0x00127e7d, 0x00127e7e, 0x00128584, 0x00128585, 0x00128685, 0x00128686, 0x00128786, 0x00128787, 0x00128887, 0x00128888, 0x00128988, 0x00128989, 0x00128a89, 0x00128a8a, 0x00128b8a, 0x00128b8b, 0x00128c8b, 0x00128c8c, 0x00128d8c, 0x00128d8d, 0x00128e8d, 0x00128e8e, 0x00128f8e, 0x00128f8f, 0x0012908f, 0x00129090, 0x00129190, 0x00129191, 0x00129291, 0x00129292, 0x00129392, 0x00129393, 0x00129493, 0x00129494, 0x00129594, 0x00129595, 0x00129695, 0x00129696, 0x00129796, 0x00129797, 0x00129897, 0x00129898, 0x00129998, 0x00129999, 0x00129a99, 0x00129a9a, 0x00129b9a, 0x00129b9b, 0x00129c9b, 0x00129c9c, 0x00129d9c, 0x00129d9d, 0x00129e9d, 0x00129e9e, 0x0013302f, 0x00133332, 0x00136463, 0x00142625],
    values: [0x00000000, 0x00000000, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000007, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000005, 0x00000001, 0x00000001, 0x00000001, 0x00000000],
    maximum: 0x00142625
};

pub global CAPTURE_1_MAX_LENGTH: u32 = 64;
pub global NUM_CAPTURE_GROUPS: u32 = 1;

/**
 * Constrains a start state to be valid
 * @dev start states are hardcoded in this function - "(start_state - {state})" for each start
 *      example: `(start_state - 0) * (start_state - 1) * (start_state - 2)` means 0, 1, or 2
 *      are valid first states
 * 
 * @param start_state - The start state of the NFA
 */
fn check_start_state(start_state: Field) {
    let valid_start_state = (start_state - 0) * (start_state - 1) * (start_state - 3);
    assert(valid_start_state == 0, "Invalid start state");
}
    
/**
 * Constrains the recognition of accept_state being reached. If an aceppt state is reached,
 *      ensures asserted traversal path is valid
 * @dev accept states are hardcoded in this function - "(next_state - {state})" for each accept
 *      example: `(next_state - 19) * (next_state - 20) * (next_state - 21)` means 19, 20, or 21
 *      are valid accept states
 * 
 * @param next_state - The asserted next state of the NFA
 * @param haystack_index - The index being operated on in the haystack
 * @param asserted_match_length - The asserted traversal path length
 * @return - 0 if accept_state is reached, nonzero otherwise
 */
fn check_accept_state(
    next_state: Field,
    haystack_index: Field, 
    asserted_match_length: Field
) -> Field {
    // check if the next state is an accept state
    let accept_state_reached = (next_state - 19);
    let accept_state_reached_bool = (accept_state_reached == 0) as Field;

    // check if the haystack index is the asserted match length
    // should equal 1 since haystack_index should be 1 less than asserted_match)length
    let asserted_path_traversed = (asserted_match_length - haystack_index == 1) as Field;

    (1 - (accept_state_reached_bool * asserted_path_traversed))
}

/**
 * SenderDomainRegex matching function
 * Regex: (?:\\r\\n|^)from:[^\\r\\n]*@([A-Za-z0-9][A-Za-z0-9\\.-]+)[>\\r\\n]
 * @param in_haystack - The input haystack to search from
 * @param match_start - The start index in the haystack for the subarray to match from
 * @param match_length - The length of the subarray to extract from haystack
 * @param current_states - The current states of the NFA at each index in the match subarray
 * @param next_states - The next states of the NFA at each index in the match subarray
 * @param capture_group_<group>_ids - The ids of the capture groups in the match subarray
 * @param capture_group_<group>_starts - The start positions of the capture groups in the match subarray
 * @param capture_group_start_indices - The start indices of the capture groups in the match subarray
 * @return - tuple of substring captures as dictated by the regular expression
 */
pub fn regex_match<let MAX_HAYSTACK_LEN: u32, let MAX_MATCH_LEN: u32>(
    in_haystack: [u8; MAX_HAYSTACK_LEN],
    match_start: u32,
    match_length: u32,
    current_states: [Field; MAX_MATCH_LEN],
    next_states: [Field; MAX_MATCH_LEN],
    capture_group_1_id: [Field; MAX_MATCH_LEN],
    capture_group_1_start: [Field; MAX_MATCH_LEN],
    capture_group_start_indices: [Field; NUM_CAPTURE_GROUPS],
) -> (BoundedVec<u8, CAPTURE_1_MAX_LENGTH>) {
    // resize haystack 
    let haystack: [u8; MAX_MATCH_LEN] = select_subarray::<MAX_HAYSTACK_LEN, MAX_MATCH_LEN>(in_haystack, match_start, match_length);

    check_start_state(current_states[0]);
    for i in 0..MAX_MATCH_LEN-1 {
        // match length - 1 since current states should be 1 less than next states
        let in_range = (i < match_length - 1) as Field;
        let matching_states = current_states[i + 1] - next_states[i];
        assert(in_range * matching_states == 0, "Invalid Transition Input");
    }
    let mut reached_end_state = 1;
    for i in 0..MAX_MATCH_LEN {
        let active_capture_groups_at_index = [capture_group_1_id[i]];
        let active_capture_groups_starts_at_index = [capture_group_1_start[i]];
        check_transition_with_captures(
            TRANSITION_TABLE,
            haystack[i] as Field,
            current_states[i],
            next_states[i],
            active_capture_groups_at_index,
            active_capture_groups_starts_at_index,
            reached_end_state
        );
        reached_end_state = reached_end_state * check_accept_state(next_states[i], i as Field, match_length as Field);
    }
    assert(reached_end_state == 0, "Did not reach a valid end state");

    // Capture Group 1
    let capture_1 = capture_substring::<MAX_MATCH_LEN, CAPTURE_1_MAX_LENGTH, 1>(
       haystack,
       capture_group_1_id,
       capture_group_1_start,
       capture_group_start_indices[0]
    );

    (capture_1)
}

